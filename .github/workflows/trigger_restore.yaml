# .github/workflows/trigger-restore.yml in main branch
name: Trigger Restore on PR Merge
on:
  pull_request:
    types: [closed]
    branches: [main, develop]

jobs:
  trigger_restore:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Restore Workflow
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}  # PAT with `repo` scope
        run: |
          curl -X POST \
            -H "Authorization: token $GH_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/${{ github.repository }}/dispatches" \
            -d '{
              "event_type": "trigger_restore",
              "client_payload": {
                "branch": "${{ github.base_ref }}"
              }
            }'
